{% load static %}

<!DOCTYPE html>
<html lang="en" style="height: 100%; box-sizing: border-box">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>FoodOnline</title>
		<!-- Google Font Family Link Start -->
		<link
			rel="stylesheet"
			type="text/css"
			href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
		/>
		<link
			rel="stylesheet"
			type="text/css"
			href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800"
		/>
		<!-- Google Font Family Link End -->

		<!-- CSS -->
		<link href="{% static 'css/iconmoon.css' %} " rel="stylesheet" />
		<link href="{% static ' css/style.css' %}" rel="stylesheet" />
		<link href="{% static 'css/cs-foodbakery-plugin.css' %} " rel="stylesheet" />
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		/>
		<link href="{% static 'css/bootstrap-slider.css' %} " rel="stylesheet" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
		/>
		<link rel="stylesheet" href="{% static 'css/custom.css' %}" />
	</head>

	<body style="height: 100%">
		<!--Main Wrapper-->
		<div style="display: flex; flex-direction: column; height: 100%;">
			{% include 'includes/navbar.html' %}
			<div style="flex-grow: 1">{% block content %}{% endblock content %}</div>

			{% include 'includes/footer.html' %}
		</div>

		<!-- Modal Popup End -->
		<script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src=" {% static 'js/modernizr.js' %} "></script>
		<script src=" {% static 'js/bootstrap.js' %} "></script>
		<script src=" {% static 'js/scripts.js' %} "></script>
		<script src=" {% static 'js/functions.js' %} "></script>
		<script src="{% static 'js/custom.js' %}"></script>
		<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
		{% if '/profile/' in request.GET %}
		<script
			src="https://maps.googleapis.com/maps/api/js?key={{GOOGLE_API_KEY}}&libraries=places&callback=initAutoComplete"
			async
			defer
		></script>
		{% endif %}

		<script>
			$(document).ready(function() {
				{% comment %} 
				add to cart btns
				{% endcomment %}
				$('.add-to-cart').on("click", function() {
					
					food_id = $(this).attr('data-id')
					url = $(this).attr('data-url')
					data = {
						food_id: food_id
					}
					
					$.ajax({
						type: 'GET',
						url,
						data,
						success: function(response) {
							console.log(response)
							if (response.status === 'Login_required') {
								swal(response.message, '', 'info').then(function() {
									window.location = '/login';
								})
							} else if (response.status === 'Failed') {
								swal(response.message, '', 'error')
							} else {
								$('#cart_counter').html(response.cart_counter['cart_count'])
								$(`#qty-${food_id}`).html(response.qty)


								applyCartAmounts(
									response.cart_amount['subtotal'],
									response.cart_amount['tax'],
									response.cart_amount['grand_total'],
								)
							}
							
						}
					})
				})

				$('.item-qty').each(function() {
					const the_id = $(this).attr('id')
					const qty = $(this).attr('data-qty')
					$(`#${the_id}`).html(qty)
				})


				{% comment %} 
				remove to cart btns
				{% endcomment %}
				$('.decrease-cart').on("click", function() {
					
					food_id = $(this).attr('data-id')
					cart_id = $(this).attr('id')
					url = $(this).attr('data-url')
					data = {
						food_id: food_id
					}
					
					$.ajax({
						type: 'GET',
						url,
						data,
						success: function(response) {
							console.log(response)
							if (response.status === 'Login_required') {
								swal(response.message, '', 'info').then(function() {
									window.location = '/login';
								})
							} else if (response.status === 'Failed') {
								swal(response.message, '', 'error')
							} else {
								$('#cart_counter').html(response.cart_counter['cart_count'])
								$(`#qty-${food_id}`).html(response.qty)

								removeCartItem(response.qty, cart_id)
								ckeckCartEmpty()


								applyCartAmounts(
									response.cart_amount['subtotal'],
									response.cart_amount['tax'],
									response.cart_amount['grand_total'],
								)
								
							}
							
						}
					})
				})


				{% comment %} 
				deleted crt item
				{% endcomment %}
				$('.delete-cart').on("click", function() {
					
					cart_id = $(this).attr('data-id')
					url = $(this).attr('data-url')
					data = {
						cart_id: cart_id
					}
					
					$.ajax({
						type: 'GET',
						url,
						data,
						success: function(response) {
							console.log(response)
							if (response.status === 'Failed') {
								swal(response.message, '', 'error')
							} else {
								$('#cart_counter').html(response.cart_counter['cart_count'])
								swal(response.status, response.message, "success")

								removeCartItem(0, cart_id)
								ckeckCartEmpty()

								applyCartAmounts(
									response.cart_amount['subtotal'],
									response.cart_amount['tax'],
									response.cart_amount['grand_total'],
								)
							}
							
						}
					})
				})


				{% comment %} 
				deleted crt item element ife qty 0
				{% endcomment %}
				function removeCartItem(cartItemQty, cart_id) {
					if (window.location.pathname === '/cart/') {

						if (cartItemQty <= 0) {
							document.getElementById(`cart-item-${cart_id}`).remove()
						}
					}
				}


				function ckeckCartEmpty() {
					let cart_counter = document.querySelector('#cart_counter').innerHTML
					if (window.location.pathname === '/cart/') {

						if (cart_counter == 0) {
							document.querySelector('#empty-cart').style.display = "block"
						}
					}
				}


				function applyCartAmounts(subtotal, tax, grand_total) {
					if (window.location.pathname === '/cart/') {
						$('#subtotal').html(subtotal)
						$('#tax').html(tax)
						$('#total').html(grand_total)

					}
				}
			})
			
		</script>
	</body>
</html>
